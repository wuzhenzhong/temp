# cluster forget

```javascript
CLUSTER FORGET node-id
```

**自3.0.0起可用。**

**时间复杂度：** O（1）

该命令用于从接收命令的 Redis 群集节点的*已知节点*集合中删除通过节点 ID 指定的节点。换句话说，从接收命令的节点的*节点表*中删除指定的节点。

因为当给定节点是群集的一部分时，参与群集的所有其他节点都知道它，为了将节点从群集中彻底删除，必须将 CLUSTER FORGET 命令发送到所有其余节点，无论他们是主人或奴隶。

然而，该命令不能简单地从收到该命令的节点的内部节点表中删除该节点，它也实现禁止列表，不允许再次添加同一节点作为处理心跳分组的*八卦部分*的副作用从其他节点收到。

## 有关为什么需要禁止列表的详细信息

在下面的例子中，我们将说明为什么该命令不能仅从节点表中移除给定的节点，而是要阻止它再次被重新插入一段时间。

假设我们有四个节点，A，B，C 和 D。为了仅以三个节点集群 A，B，C 结束，我们可以按照以下步骤操作：

\1. 重新整理从 D 到节点 A，B，C的 所有散列槽。

\2. D 现在是空的，但仍列在 A，B 和 C 的节点表中。

\3. 我们联系 A，并发送`CLUSTER FORGET D`。

\4. B 向节点 A 发送心跳数据包，其中列出了节点 D.

\5. A不再知道节点D（见步骤3），所以它开始与D握手。

\6. D 端重新添加到 A 的节点表中。

正如你所看到的那样，删除一个节点是脆弱的，我们需要发送 CLUSTER FORGET 命令给所有的节点，希望在此期间没有处理八卦部分。由于这个问题，该命令为每个条目实施一个带有过期时间的禁止列表。

那么该命令真正的作用是：

\1. 指定的节点将从节点表中删除。

\2. 删除的节点的节点 ID 被添加到禁止列表中，持续1分钟。

\3. 在处理来自其他节点的心跳包中收到的八卦部分时，节点将跳过禁止列表中列出的所有节点 ID。

这样我们有一个60秒的窗口来通知群集中的所有节点我们要删除一个节点。

## 不允许命令执行的特殊条件

该命令不成功，并在以下情况下返回错误：

\1. 节点表中找不到指定的节点标识。

\2. 接收命令的节点是从属节点，并且指定的节点ID标识其当前主节点。

\2. 节点 ID 标识了我们发送命令的同一个节点。

## 返回值

[简单的字符串回复](https://redis.io/topics/protocol#simple-string-reply)：`OK`如果命令执行成功，否则返回错误。

本文档系腾讯云云+社区成员共同维护，如有问题请联系 yunjia_community@tencent.com

最后更新于：2017-12-18